<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸšš Rider Absconding Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* Aurora Background */
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: radial-gradient(circle at top left, #1a2a6c, #b21f1f, #fdbb2d);
      overflow: hidden;
    }

    body::before {
      content: "";
      position: absolute;
      width: 200%;
      height: 200%;
      background: conic-gradient(from 0deg, #00f260, #0575e6, #64f38c, #f79d00, #ff6a00, #ee0979, #00f260);
      animation: aurora 15s linear infinite;
      filter: blur(120px);
      opacity: 0.3;
    }

    @keyframes aurora {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Container */
    .container {
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(16px);
      border-radius: 20px;
      padding: 30px;
      max-width: 950px;
      width: 95%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      animation: popIn 1s ease forwards;
    }

    @keyframes popIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 20px;
      background: linear-gradient(90deg, #ff6ec4, #7873f5, #00f2fe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 5s infinite linear;
    }

    @keyframes shimmer {
      from { background-position: 0%; }
      to { background-position: 200%; }
    }

    /* Inputs */
    .form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    input, select {
      padding: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      background: rgba(255,255,255,0.2);
      color: #fff;
      transition: all 0.3s;
    }

    input:focus, select:focus {
      background: rgba(255,255,255,0.35);
      transform: scale(1.05);
    }

    /* Buttons */
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: #fff;
      font-weight: 600;
      transition: 0.3s;
    }

    .add-btn {
      background: linear-gradient(45deg, #00f2fe, #4facfe);
    }
    .add-btn:hover { transform: scale(1.1); }

    .export-btn {
      background: linear-gradient(45deg, #f7971e, #ffd200);
      color: #000;
    }
    .export-btn:hover { transform: scale(1.1); }

    .clear-btn {
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
    }
    .clear-btn:hover { transform: scale(1.1); }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      border-radius: 12px;
      overflow: hidden;
    }

    thead {
      background: rgba(0,0,0,0.4);
      color: #fff;
    }

    th, td {
      padding: 12px;
      text-align: center;
    }

    tbody tr {
      background: rgba(255,255,255,0.1);
      color: #fff;
      transition: 0.4s;
    }

    tbody tr:hover {
      background: rgba(255,255,255,0.25);
    }

    .action-btn {
      padding: 6px 12px;
      margin: 0 3px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    .edit-btn { background: #3ddc97; }
    .delete-btn { background: #ff4b5c; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸšš Rider Absconding Details</h2>

    <div class="form">
      <input type="text" id="riderName" placeholder="Rider Name">
      <input type="text" id="orderId" placeholder="Order ID">
      <select id="remarks">
        <option value="Rider Absconded with the order">Rider Absconded with the order</option>
        <option value="Rider Lost Contact">Rider Lost Contact</option>
        <option value="Other">Other</option>
      </select>
      <input type="text" id="phoneNumber" placeholder="Phone Number">
      <button class="add-btn" onclick="addEntry()">Add</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Rider Name</th>
          <th>Order ID</th>
          <th>Remarks</th>
          <th>Phone Number</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="trackerTable"></tbody>
    </table>

    <div style="margin-top: 15px; display: flex; gap: 10px;">
      <button class="export-btn" onclick="exportToCSV()">Export to CSV</button>
      <button class="clear-btn" onclick="clearAll()">Clear All</button>
    </div>
  </div>

  <!-- Firebase + App Script -->
  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, remove, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // Firebase config (your own keys here)
    const firebaseConfig = {
      apiKey: "AIzaSyC3de0poQVQ8Sa4SO2P2lVvukgtWkxfHtk",
      authDomain: "rider-absconding.firebaseapp.com",
      databaseURL: "https://rider-absconding-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "rider-absconding",
      storageBucket: "rider-absconding.appspot.com",
      messagingSenderId: "16507000056",
      appId: "1:16507000056:web:88505129b8839e1f53970d",
      measurementId: "G-PP2Y2HW8W1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, "entries");

    // Add entry
    window.addEntry = async function() {
      const name = document.getElementById("riderName").value.trim();
      const orderId = document.getElementById("orderId").value.trim();
      const remarks = document.getElementById("remarks").value;
      const phone = document.getElementById("phoneNumber").value.trim();

      if (!name || !orderId || !phone) {
        alert("Fill all fields");
        return;
      }

      await push(dbRef, { name, orderId, remarks, phone });
      document.getElementById("riderName").value = "";
      document.getElementById("orderId").value = "";
      document.getElementById("phoneNumber").value = "";
    };

    // Render table
    onValue(dbRef, (snapshot) => {
      const table = document.getElementById("trackerTable");
      table.innerHTML = "";
      snapshot.forEach((childSnap) => {
        const entry = childSnap.val();
        const id = childSnap.key;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${entry.name}</td>
          <td>${entry.orderId}</td>
          <td>${entry.remarks}</td>
          <td>${entry.phone}</td>
          <td>
            <button class="action-btn edit-btn" onclick="editEntry('${id}','${entry.name}','${entry.orderId}','${entry.remarks}','${entry.phone}')">Edit</button>
            <button class="action-btn delete-btn" onclick="deleteEntry('${id}')">Delete</button>
          </td>
        `;
        table.appendChild(row);
      });
    });

    // Delete entry
    window.deleteEntry = async function(id) {
      await remove(ref(db, "entries/" + id));
    };

    // Edit entry
    window.editEntry = function(id, name, orderId, remarks, phone) {
      document.getElementById("riderName").value = name;
      document.getElementById("orderId").value = orderId;
      document.getElementById("remarks").value = remarks;
      document.getElementById("phoneNumber").value = phone;

      deleteEntry(id);
    };

    // Export to CSV
    window.exportToCSV = function() {
      const rows = [["Rider Name","Order ID","Remarks","Phone Number"]];
      document.querySelectorAll("#trackerTable tr").forEach((tr) => {
        const cols = Array.from(tr.children).slice(0,4).map(td => td.innerText);
        rows.push(cols);
      });

      let csvContent = rows.map(e => e.join(",")).join("\n");
      let blob = new Blob([csvContent], { type: "text/csv" });
      let url = window.URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "rider_absconding.csv";
      a.click();
    };

    // Clear all
    window.clearAll = async function() {
      if (confirm("Delete all entries?")) {
        await remove(dbRef);
      }
    };
  </script>
</body>
</html>
